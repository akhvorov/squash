<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏–≥—Ä—ã –≤ —Å–∫–≤–æ—à</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-section {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .results {
            padding: 40px;
            background: #f8f9fa;
            border-top: 1px solid #e1e5e9;
        }

        .results.hidden {
            display: none;
        }

        .cost-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .cost-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.1em;
            color: #667eea;
        }

        .plan-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .plan-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .court-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #4facfe;
        }

        .payments-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .payments-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .payment-item:last-child {
            border-bottom: none;
        }

        .player-with-sub {
            color: #28a745;
            font-weight: 600;
        }

        .player-normal {
            color: #333;
        }

        .amount {
            font-weight: 600;
            color: #667eea;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .form-section, .results {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∏ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–∫–≤–æ—à–∞</h1>
            <p>–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –æ–ø–ª–∞—Ç—ã —Å —É—á–µ—Ç–æ–º –ø–æ–¥–ø–∏—Å–æ–∫ Urban Sports</p>
        </div>

        <div class="form-section">
            <div class="form-row">
                <div class="form-group">
                    <label for="courts">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä—Ç–æ–≤</label>
                    <input type="number" id="courts" min="1" max="10" value="3">
                </div>
                <div class="form-group">
                    <label for="players">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</label>
                    <input type="number" id="players" min="2" max="20" value="6">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="subs">–ò–≥—Ä–æ–∫–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π Urban Sports</label>
                    <input type="number" id="subs" min="0" max="20" value="3">
                </div>
                <div class="form-group">
                    <label for="border_slot">–ì—Ä–∞–Ω–∏—Ü–∞ –≤—Ä–µ–º–µ–Ω–∏ (—Å–ª–æ—Ç)</label>
                    <select id="border_slot">
                        <option value="0">–û–±–∞ —Å–ª–æ—Ç–∞ –ø–æ—Å–ª–µ 21:00</option>
                        <option value="1">–ü–µ—Ä–≤—ã–π –¥–æ 21:00, –≤—Ç–æ—Ä–æ–π –ø–æ—Å–ª–µ</option>
                        <option value="2" selected>–û–±–∞ —Å–ª–æ—Ç–∞ –¥–æ 21:00</option>
                    </select>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É</button>
        </div>

        <div class="results hidden" id="results">
            <div class="cost-summary">
                <h3>üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å</h3>
                <div class="cost-item">
                    <span>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏):</span>
                    <span id="actual-cost">-</span>
                </div>
                <div class="cost-item">
                    <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –±–µ–∑ –ø–æ–¥–ø–∏—Å–æ–∫:</span>
                    <span id="cost-without-subs">-</span>
                </div>
                <div class="cost-item">
                    <span>–≠–∫–æ–Ω–æ–º–∏—è –æ—Ç –ø–æ–¥–ø–∏—Å–æ–∫:</span>
                    <span id="savings">-</span>
                </div>
            </div>

            <div class="plan-section">
                <h3>üìã –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω</h3>
                <div id="plan-details"></div>
            </div>

            <div class="payments-section">
                <h3>üí≥ –ü–ª–∞—Ç–µ–∂–∏ –ø–æ –∏–≥—Ä–æ–∫–∞–º</h3>
                <div id="payments-details"></div>
            </div>
        </div>
    </div>

    <script>
        // –¶–µ–Ω—ã –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞
        const PRICES = {
            slot_before_21: 9,    // —Å–ª–æ—Ç –¥–æ 21:00
            slot_after_21: 6,     // —Å–ª–æ—Ç –ø–æ—Å–ª–µ 21:00
            pp_before_21: 12,     // PowerPlay –¥–æ 21:00
            pp_after_21: 9        // PowerPlay –ø–æ—Å–ª–µ 21:00
        };

        function getSlotPrice(slotIndex, borderSlot) {
            return slotIndex < borderSlot ? PRICES.slot_before_21 : PRICES.slot_after_21;
        }

        function getPPPrice(slotIndex, borderSlot) {
            if (slotIndex + 1 < borderSlot) return PRICES.pp_before_21;
            if (slotIndex >= borderSlot) return PRICES.pp_after_21;
            return PRICES.pp_before_21;
        }

        function squashMinCost(courts, subs, borderSlot) {
            let bestCost = Infinity;
            let bestPlan = null;
            const costWithoutSubs = courts * getPPPrice(0, borderSlot) * 2;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–æ—Ä—Ç–æ–≤
            const choices = generateChoices(courts);
            
            for (const choice of choices) {
                let costAsPP = 0;
                let slotsForSubs = [];
                
                for (const c of choice) {
                    if (c === "pp") {
                        costAsPP += getPPPrice(0, borderSlot) * 2;
                    } else {
                        // –û–±—ã—á–Ω—ã–π –∫–æ—Ä—Ç = 2 —Å–ª–æ—Ç–∞ –Ω–∞ –∫–∞–∂–¥–æ–≥–æ –∏–∑ 2-—Ö –∏–≥—Ä–æ–∫–æ–≤
                        slotsForSubs.push(getSlotPrice(0, borderSlot));
                        slotsForSubs.push(getSlotPrice(0, borderSlot));
                        slotsForSubs.push(getSlotPrice(1, borderSlot));
                        slotsForSubs.push(getSlotPrice(1, borderSlot));
                    }
                }

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–¥–ø–∏—Å–∫–∏ –∫ —Ä–∞–∑–±–∏—Ç—ã–º —Å–ª–æ—Ç–∞–º
                const freeSlots = subs;
                const slotCostsSorted = slotsForSubs.sort((a, b) => a - b);
                const paidSlots = slotCostsSorted.slice(freeSlots);
                const costWithSubs = paidSlots.reduce((sum, cost) => sum + cost, 0);
                
                const totalCost = costAsPP + costWithSubs;

                if (totalCost < bestCost) {
                    bestCost = totalCost;
                    bestPlan = choice;
                }
            }

            return { cost: bestCost, plan: bestPlan, costWithoutSubs };
        }

        function generateChoices(courts) {
            const choices = [];
            const generate = (current, remaining) => {
                if (remaining === 0) {
                    choices.push([...current]);
                    return;
                }
                current.push("pp");
                generate(current, remaining - 1);
                current.pop();
                current.push("slots");
                generate(current, remaining - 1);
                current.pop();
            };
            generate([], courts);
            return choices;
        }

        function calculatePayments(actualCost, costWithoutSubs, players, subs) {
            const savings = costWithoutSubs - actualCost;
            const baseCostPerPerson = costWithoutSubs / players;
            const savingsPerSub = subs > 0 ? savings / subs : 0;
            
            const normalPayment = baseCostPerPerson;
            const subsPayment = baseCostPerPerson - savingsPerSub;
            
            const payments = {};
            for (let i = 1; i <= players; i++) {
                if (i <= subs) {
                    payments[`–ò–≥—Ä–æ–∫ ${i} (—Å –ø–æ–¥–ø–∏—Å–∫–æ–π)`] = Math.round(subsPayment * 100) / 100;
                } else {
                    payments[`–ò–≥—Ä–æ–∫ ${i}`] = Math.round(normalPayment * 100) / 100;
                }
            }
            
            return payments;
        }

        function formatPlan(plan, borderSlot) {
            const details = [];
            let totalSubsUsed = 0;
            
            for (let i = 0; i < plan.length; i++) {
                const courtNum = i + 1;
                const choice = plan[i];
                
                if (choice === "pp") {
                    const ppCost = getPPPrice(0, borderSlot) * 2;
                    const timeDesc = 0 < borderSlot ? "–¥–æ 21:00" : "–ø–æ—Å–ª–µ 21:00";
                    details.push(`<div class="court-item">–ö–æ—Ä—Ç ${courtNum}: PowerPlay (${timeDesc}) - ${ppCost}‚Ç¨</div>`);
                } else {
                    const slot1Cost = getSlotPrice(0, borderSlot);
                    const slot2Cost = getSlotPrice(1, borderSlot);
                    const time1 = 0 < borderSlot ? "–¥–æ 21:00" : "–ø–æ—Å–ª–µ 21:00";
                    const time2 = 1 < borderSlot ? "–¥–æ 21:00" : "–ø–æ—Å–ª–µ 21:00";
                    
                    const remainingSubs = parseInt(document.getElementById('subs').value) - totalSubsUsed;
                    const courtSlots = [slot1Cost, slot1Cost, slot2Cost, slot2Cost];
                    const courtSlotsSorted = courtSlots.sort((a, b) => a - b);
                    
                    const subsForCourt = Math.min(remainingSubs, courtSlots.length);
                    const paidSlots = courtSlotsSorted.slice(subsForCourt);
                    const courtCost = paidSlots.reduce((sum, cost) => sum + cost, 0);
                    
                    totalSubsUsed += subsForCourt;
                    
                    details.push(`<div class="court-item">–ö–æ—Ä—Ç ${courtNum}: ${subsForCourt} –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ + ${paidSlots.length} –æ–ø–ª–∞—Ç–æ–π = ${courtCost}‚Ç¨ (${time1}, ${time2})</div>`);
                }
            }
            
            return details.join('');
        }

        function calculate() {
            const courts = parseInt(document.getElementById('courts').value);
            const players = parseInt(document.getElementById('players').value);
            const subs = parseInt(document.getElementById('subs').value);
            const borderSlot = parseInt(document.getElementById('border_slot').value);

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (subs > players) {
                showError('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤');
                return;
            }

            if (players < 2) {
                showError('–ú–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞');
                return;
            }

            if (courts < 1) {
                showError('–ú–∏–Ω–∏–º—É–º 1 –∫–æ—Ä—Ç');
                return;
            }

            try {
                const result = squashMinCost(courts, subs, borderSlot);
                const payments = calculatePayments(result.cost, result.costWithoutSubs, players, subs);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                document.getElementById('actual-cost').textContent = `${result.cost} ‚Ç¨`;
                document.getElementById('cost-without-subs').textContent = `${result.costWithoutSubs} ‚Ç¨`;
                document.getElementById('savings').textContent = `${result.costWithoutSubs - result.cost} ‚Ç¨`;
                
                document.getElementById('plan-details').innerHTML = formatPlan(result.plan, borderSlot);
                
                const paymentsHTML = Object.entries(payments).map(([player, amount]) => {
                    const className = player.includes('–ø–æ–¥–ø–∏—Å–∫–æ–π') ? 'player-with-sub' : 'player-normal';
                    return `<div class="payment-item">
                        <span class="${className}">${player}</span>
                        <span class="amount">${amount} ‚Ç¨</span>
                    </div>`;
                }).join('');
                
                document.getElementById('payments-details').innerHTML = paymentsHTML;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                document.getElementById('results').classList.remove('hidden');
                hideError();
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ: ' + error.message);
            }
        }

        function showError(message) {
            let errorDiv = document.getElementById('error-message');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'error-message';
                errorDiv.className = 'error';
                document.querySelector('.form-section').appendChild(errorDiv);
            }
            errorDiv.textContent = message;
        }

        function hideError() {
            const errorDiv = document.getElementById('error-message');
            if (errorDiv) {
                errorDiv.remove();
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', calculate);
                input.addEventListener('input', calculate);
            });
        });
    </script>
</body>
</html>
