<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏–≥—Ä—ã –≤ —Å–∫–≤–æ—à</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .form-section {
            padding: 40px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 1.1em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .calculate-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .calculate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .results {
            padding: 40px;
            background: #f8f9fa;
            border-top: 1px solid #e1e5e9;
        }

        .results.hidden {
            display: none;
        }

        .cost-summary {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .cost-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .cost-item:last-child {
            border-bottom: none;
            font-weight: 600;
            font-size: 1.1em;
            color: #667eea;
        }

        .plan-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .plan-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .court-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #4facfe;
        }

        .payments-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .payments-section h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .payment-item:last-child {
            border-bottom: none;
        }

        .player-with-sub {
            color: #28a745;
            font-weight: 600;
        }

        .player-normal {
            color: #333;
        }

        .amount {
            font-weight: 600;
            color: #667eea;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .form-section, .results {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè∏ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Å–∫–≤–æ—à–∞</h1>
            <p>–û–ø—Ç–∏–º–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞ –æ–ø–ª–∞—Ç—ã —Å —É—á–µ—Ç–æ–º –ø–æ–¥–ø–∏—Å–æ–∫ Urban Sports</p>
            <div style="margin-top: 15px; font-size: 0.9em; opacity: 0.9;">
                <div><strong>–†–∞–±–æ—á–∏–µ –¥–Ω–∏:</strong> –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å 16:30-21:00 (9‚Ç¨/12‚Ç¨) | –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (6‚Ç¨/9‚Ç¨)</div>
                <div><strong>–í—ã—Ö–æ–¥–Ω—ã–µ:</strong> –≤—Å–µ –≤—Ä–µ–º—è (6‚Ç¨/9‚Ç¨)</div>
            </div>
        </div>

        <div class="form-section">
            <div class="form-row">
                <div class="form-group">
                    <label for="courts">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ—Ä—Ç–æ–≤</label>
                    <input type="number" id="courts" min="1" max="10" value="3">
                </div>
                <div class="form-group">
                    <label for="players">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤</label>
                    <input type="number" id="players" min="2" max="20" value="6">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="subs">–ò–≥—Ä–æ–∫–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π Urban Sports</label>
                    <input type="number" id="subs" min="0" max="20" value="3">
                </div>
                <div class="form-group">
                    <label for="day_type">–¢–∏–ø –¥–Ω—è</label>
                    <select id="day_type">
                        <option value="weekday" selected>–†–∞–±–æ—á–∏–π –¥–µ–Ω—å</option>
                        <option value="weekend">–í—ã—Ö–æ–¥–Ω–æ–π</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="start_time">–í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã</label>
                    <input type="time" id="start_time" value="18:00">
                </div>
                <div class="form-group">
                    <label for="duration">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (—á–∞—Å—ã)</label>
                    <select id="duration">
                        <option value="1.5" selected>1.5 —á–∞—Å–∞ (PowerPlay)</option>
                        <option value="0.75">45 –º–∏–Ω—É—Ç (–æ–±—ã—á–Ω—ã–π —Å–ª–æ—Ç)</option>
                    </select>
                </div>
            </div>

            <button class="calculate-btn" onclick="calculate()">–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –æ–ø—Ç–∏–º–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É</button>
        </div>

        <div class="results hidden" id="results">
            <div class="cost-summary">
                <h3>üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å</h3>
                <div class="cost-item">
                    <span>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏):</span>
                    <span id="actual-cost">-</span>
                </div>
                <div class="cost-item">
                    <span>–°—Ç–æ–∏–º–æ—Å—Ç—å –±–µ–∑ –ø–æ–¥–ø–∏—Å–æ–∫:</span>
                    <span id="cost-without-subs">-</span>
                </div>
                <div class="cost-item">
                    <span>–≠–∫–æ–Ω–æ–º–∏—è –æ—Ç –ø–æ–¥–ø–∏—Å–æ–∫:</span>
                    <span id="savings">-</span>
                </div>
            </div>

            <div class="plan-section">
                <h3>üìã –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω</h3>
                <div id="plan-details"></div>
            </div>

            <div class="payments-section">
                <h3>üí≥ –ü–ª–∞—Ç–µ–∂–∏ –ø–æ –∏–≥—Ä–æ–∫–∞–º</h3>
                <div id="payments-details"></div>
            </div>
        </div>
    </div>

    <script>
        // –¶–µ–Ω—ã –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞
        const PRICES = {
            // –†–∞–±–æ—á–∏–µ –¥–Ω–∏
            weekday: {
                peak: { slot: 9, pp: 12 },      // 16:30-21:00
                off_peak: { slot: 6, pp: 9 }    // –æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è
            },
            // –í—ã—Ö–æ–¥–Ω—ã–µ
            weekend: {
                peak: { slot: 6, pp: 9 },       // –≤—Å–µ–≥–¥–∞ –¥–µ—à–µ–≤–ª–µ
                off_peak: { slot: 6, pp: 9 }
            }
        };

        function getPriceForTime(startTime, dayType, duration) {
            const startHour = parseInt(startTime.split(':')[0]);
            const startMinute = parseInt(startTime.split(':')[1]);
            const startTimeMinutes = startHour * 60 + startMinute;
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è –ª–∏ –≤—Ä–µ–º—è –∏–≥—Ä—ã —Å –ø–∏–∫–æ–≤—ã–º –ø–µ—Ä–∏–æ–¥–æ–º (16:30-21:00)
            const peakStart = 16 * 60 + 30; // 16:30
            const peakEnd = 21 * 60;        // 21:00
            
            // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            const gameDurationMinutes = duration * 60;
            const endTimeMinutes = startTimeMinutes + gameDurationMinutes;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
            const isPeakTime = (startTimeMinutes < peakEnd && endTimeMinutes > peakStart);
            const priceCategory = isPeakTime ? 'peak' : 'off_peak';
            
            const dayPrices = PRICES[dayType];
            const prices = dayPrices[priceCategory];
            
            if (duration === 1.5) {
                return prices.pp; // PowerPlay
            } else {
                return prices.slot; // –û–±—ã—á–Ω—ã–π —Å–ª–æ—Ç
            }
        }

        function getSlotPrice(startTime, dayType, slotIndex) {
            // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ —Å–ª–æ—Ç–∞ (45 –º–∏–Ω—É—Ç)
            const [hours, minutes] = startTime.split(':').map(Number);
            const slotStartMinutes = hours * 60 + minutes + (slotIndex * 45);
            const slotStartHours = Math.floor(slotStartMinutes / 60);
            const slotStartMins = slotStartMinutes % 60;
            
            const slotTimeStr = slotStartHours.toString().padStart(2, '0') + ':' + 
                               slotStartMins.toString().padStart(2, '0');
            
            return getPriceForTime(slotTimeStr, dayType, 0.75);
        }

        function getPPPrice(startTime, dayType) {
            return getPriceForTime(startTime, dayType, 1.5);
        }

        function squashMinCost(courts, subs, startTime, dayType) {
            let bestCost = Infinity;
            let bestPlan = null;
            const costWithoutSubs = courts * getPPPrice(startTime, dayType) * 2;

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤—Å–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∫–æ—Ä—Ç–æ–≤
            const choices = generateChoices(courts);
            
            for (const choice of choices) {
                let costAsPP = 0;
                let slotsForSubs = [];
                
                for (const c of choice) {
                    if (c === "pp") {
                        costAsPP += getPPPrice(startTime, dayType) * 2;
                    } else {
                        // –û–±—ã—á–Ω—ã–π –∫–æ—Ä—Ç = 2 —Å–ª–æ—Ç–∞ –Ω–∞ –∫–∞–∂–¥–æ–≥–æ –∏–∑ 2-—Ö –∏–≥—Ä–æ–∫–æ–≤
                        slotsForSubs.push(getSlotPrice(startTime, dayType, 0));
                        slotsForSubs.push(getSlotPrice(startTime, dayType, 0));
                        slotsForSubs.push(getSlotPrice(startTime, dayType, 1));
                        slotsForSubs.push(getSlotPrice(startTime, dayType, 1));
                    }
                }

                // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–¥–ø–∏—Å–∫–∏ –∫ —Ä–∞–∑–±–∏—Ç—ã–º —Å–ª–æ—Ç–∞–º
                const freeSlots = subs;
                const slotCostsSorted = slotsForSubs.sort((a, b) => a - b);
                const paidSlots = slotCostsSorted.slice(freeSlots);
                const costWithSubs = paidSlots.reduce((sum, cost) => sum + cost, 0);
                
                const totalCost = costAsPP + costWithSubs;

                if (totalCost < bestCost) {
                    bestCost = totalCost;
                    bestPlan = choice;
                }
            }

            return { cost: bestCost, plan: bestPlan, costWithoutSubs };
        }

        function generateChoices(courts) {
            const choices = [];
            const generate = (current, remaining) => {
                if (remaining === 0) {
                    choices.push([...current]);
                    return;
                }
                current.push("pp");
                generate(current, remaining - 1);
                current.pop();
                current.push("slots");
                generate(current, remaining - 1);
                current.pop();
            };
            generate([], courts);
            return choices;
        }

        function calculatePayments(actualCost, costWithoutSubs, players, subs) {
            const savings = costWithoutSubs - actualCost;
            const baseCostPerPerson = costWithoutSubs / players;
            const savingsPerSub = subs > 0 ? savings / subs : 0;
            
            const normalPayment = baseCostPerPerson;
            const subsPayment = baseCostPerPerson - savingsPerSub;
            
            const payments = {};
            for (let i = 1; i <= players; i++) {
                if (i <= subs) {
                    payments[`–ò–≥—Ä–æ–∫ ${i} (—Å –ø–æ–¥–ø–∏—Å–∫–æ–π)`] = Math.round(subsPayment * 100) / 100;
                } else {
                    payments[`–ò–≥—Ä–æ–∫ ${i}`] = Math.round(normalPayment * 100) / 100;
                }
            }
            
            return payments;
        }

        function formatPlan(plan, startTime, dayType) {
            const details = [];
            let totalSubsUsed = 0;
            
            for (let i = 0; i < plan.length; i++) {
                const courtNum = i + 1;
                const choice = plan[i];
                
                if (choice === "pp") {
                    const ppCost = getPPPrice(startTime, dayType) * 2;
                    const timeDesc = getTimeDescription(startTime, dayType, 1.5);
                    details.push(`<div class="court-item">–ö–æ—Ä—Ç ${courtNum}: PowerPlay (${timeDesc}) - ${ppCost}‚Ç¨</div>`);
                } else {
                    const slot1Cost = getSlotPrice(startTime, dayType, 0);
                    const slot2Cost = getSlotPrice(startTime, dayType, 1);
                    const time1 = getTimeDescription(startTime, dayType, 0.75);
                    const time2 = getTimeDescription(getNextSlotTime(startTime, 1), dayType, 0.75);
                    
                    const remainingSubs = parseInt(document.getElementById('subs').value) - totalSubsUsed;
                    const courtSlots = [slot1Cost, slot1Cost, slot2Cost, slot2Cost];
                    const courtSlotsSorted = courtSlots.sort((a, b) => a - b);
                    
                    const subsForCourt = Math.min(remainingSubs, courtSlots.length);
                    const paidSlots = courtSlotsSorted.slice(subsForCourt);
                    const courtCost = paidSlots.reduce((sum, cost) => sum + cost, 0);
                    
                    totalSubsUsed += subsForCourt;
                    
                    details.push(`<div class="court-item">–ö–æ—Ä—Ç ${courtNum}: ${subsForCourt} –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ + ${paidSlots.length} –æ–ø–ª–∞—Ç–æ–π = ${courtCost}‚Ç¨ (${time1}, ${time2})</div>`);
                }
            }
            
            return details.join('');
        }

        function getTimeDescription(startTime, dayType, duration = 1.5) {
            const startHour = parseInt(startTime.split(':')[0]);
            const startMinute = parseInt(startTime.split(':')[1]);
            const startTimeMinutes = startHour * 60 + startMinute;
            
            const peakStart = 16 * 60 + 30; // 16:30
            const peakEnd = 21 * 60;        // 21:00
            
            // –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
            const gameDurationMinutes = duration * 60;
            const endTimeMinutes = startTimeMinutes + gameDurationMinutes;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
            const isPeakTime = (startTimeMinutes < peakEnd && endTimeMinutes > peakStart);
            
            if (dayType === 'weekend') {
                return '–≤—ã—Ö–æ–¥–Ω–æ–π';
            } else if (isPeakTime) {
                return '–ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç—Å—è —Å 16:30-21:00';
            } else {
                return '–æ—Å—Ç–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è';
            }
        }

        function getNextSlotTime(startTime, slotIndex) {
            const [hours, minutes] = startTime.split(':').map(Number);
            const totalMinutes = hours * 60 + minutes + (slotIndex * 45);
            const newHours = Math.floor(totalMinutes / 60);
            const newMinutes = totalMinutes % 60;
            return `${newHours.toString().padStart(2, '0')}:${newMinutes.toString().padStart(2, '0')}`;
        }

        function calculate() {
            const courts = parseInt(document.getElementById('courts').value);
            const players = parseInt(document.getElementById('players').value);
            const subs = parseInt(document.getElementById('subs').value);
            const dayType = document.getElementById('day_type').value;
            const startTime = document.getElementById('start_time').value;
            const duration = parseFloat(document.getElementById('duration').value);

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (subs > players) {
                showError('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–≥—Ä–æ–∫–æ–≤ —Å –ø–æ–¥–ø–∏—Å–∫–∞–º–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–≥—Ä–æ–∫–æ–≤');
                return;
            }

            if (players < 2) {
                showError('–ú–∏–Ω–∏–º—É–º 2 –∏–≥—Ä–æ–∫–∞');
                return;
            }

            if (courts < 1) {
                showError('–ú–∏–Ω–∏–º—É–º 1 –∫–æ—Ä—Ç');
                return;
            }

            if (!startTime) {
                showError('–£–∫–∞–∂–∏—Ç–µ –≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã');
                return;
            }

            try {
                const result = squashMinCost(courts, subs, startTime, dayType);
                const payments = calculatePayments(result.cost, result.costWithoutSubs, players, subs);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                document.getElementById('actual-cost').textContent = `${result.cost} ‚Ç¨`;
                document.getElementById('cost-without-subs').textContent = `${result.costWithoutSubs} ‚Ç¨`;
                document.getElementById('savings').textContent = `${result.costWithoutSubs - result.cost} ‚Ç¨`;
                
                document.getElementById('plan-details').innerHTML = formatPlan(result.plan, startTime, dayType);
                
                const paymentsHTML = Object.entries(payments).map(([player, amount]) => {
                    const className = player.includes('–ø–æ–¥–ø–∏—Å–∫–æ–π') ? 'player-with-sub' : 'player-normal';
                    return `<div class="payment-item">
                        <span class="${className}">${player}</span>
                        <span class="amount">${amount} ‚Ç¨</span>
                    </div>`;
                }).join('');
                
                document.getElementById('payments-details').innerHTML = paymentsHTML;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                document.getElementById('results').classList.remove('hidden');
                hideError();
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ: ' + error.message);
            }
        }

        function showError(message) {
            let errorDiv = document.getElementById('error-message');
            if (!errorDiv) {
                errorDiv = document.createElement('div');
                errorDiv.id = 'error-message';
                errorDiv.className = 'error';
                document.querySelector('.form-section').appendChild(errorDiv);
            }
            errorDiv.textContent = message;
        }

        function hideError() {
            const errorDiv = document.getElementById('error-message');
            if (errorDiv) {
                errorDiv.remove();
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('change', calculate);
                input.addEventListener('input', calculate);
            });
        });
    </script>
</body>
</html>
